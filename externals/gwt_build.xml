<?xml version="1.0"?>
<project xmlns:ivy="antlib:org.apache.ivy.ant" name="gwt_build">
  <import file="java_build.xml"/>
	
  <property name="gwtc.lib.dir" value="${lib.dir}/gwtc"/>
  <property name="web.dir" value="war/WEB-INF"/>
  <property name="web.lib.dir" value="${web.dir}/lib"/>
  <property name="web.class.dir" value="${web.dir}/classes"/>
  <property name="gwt.sdk" location="externals/lib/gwt-2.4.0"/>
	
  <target name="pre-compile">
    <echo message="${web.class.dir}"/>
    <mkdir dir="${web.class.dir}"/>
    <copy todir="${web.class.dir}">
      <fileset dir="${src.dir}" excludes="**/*.java"/>
    </copy>
  </target>
	
  <target name="pre-gwtc">
    <delete dir="${web.lib.dir}"/>
    <copy todir="${web.lib.dir}">
      <fileset dir="${runtime.lib.dir}" includes="**/*.jar"/>
    </copy>
    <copy todir="${web.class.dir}">
      <fileset dir="${build.class.dir}" includes="**/*.class"/>
    </copy>
    <path id="project.class.path">
      <pathelement location="${web.class.dir}"/>
      <fileset dir="${gwtc.lib.dir}" includes="*.jar"/>
      <fileset dir="${web.lib.dir}" includes="*.jar"/>
    </path>
  </target>
	
  <target name="gwtc" depends="compile,pre-gwtc" description="GWT compile to JavaScript">
    <java failonerror="true" fork="true" classname="com.google.gwt.dev.Compiler">
      <classpath location="src"/>
      <classpath refid="project.class.path"/>
      <!-- add jvmarg -Xss16M or similar if you see a StackOverflowError -->
      <jvmarg value="-Xmx512M"/>
      <!-- Additional arguments like -style PRETTY or -logLevel DEBUG -->
      <arg value="${gwt.project.name}"/>
    </java>
  </target>
	
  <!--target name="devmode" depends="javac" description="Run development mode">
	    <java failonerror="true" fork="true" classname="com.google.gwt.dev.DevMode">
	      <classpath>
	        <pathelement location="src"/>
	        <path refid="project.class.path"/>
	      </classpath>
	      <jvmarg value="-Xmx512M"/>
	      <arg value="-startupUrl"/>
	      <arg value="Foo.html"/>
	      <arg value="com.example.foo.Foo"/>
	    </java>
	  </target-->
  <!-- Placeholder -->
	
  <target name="pre-dist">	  	
  </target>
	
  <target name="dist" depends="gwtc, pre-dist" description="Create a war file">
    <war destfile="${dist.dir}/${ant.project.name}.war" basedir="war"/>
  </target>
	
  <target name="eclipse" description="Generate .project and .classpath files.">
    <copy tofile=".classpath" overwrite="false" failonerror="false" file="externals/eclipse/gwt/classpath_template">
      <filterset>
        <filter token="PROJECT_NAME" value="${ant.project.name}"/>
      </filterset>
    </copy>
    <copy tofile=".project" overwrite="false" failonerror="false" file="externals/eclipse/gwt/project_template">
      <filterset>
        <filter token="PROJECT_NAME" value="${ant.project.name}"/>
      </filterset>
   </copy>
    <copy todir=".settings" overwrite="false" failonerror="false">
      <fileset dir="externals/eclipse/gwt/settings"></fileset>
    </copy>  	
  </target>
</project>
